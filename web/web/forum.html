<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>sc.chinaz.com</title>
	<meta name="author" content="ZERGE" />
	<meta name="keywords" content="responsive html template, portfolio, creative, design, clean, minimal, light, dark, twitter, bootstrap" />
	<meta name="description" content="Responsive HTML Template - Blog Post Page" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Styles -->
    
    <link href="css/bootstrap.css" rel="stylesheet" />
    <link href="css/bootstrap-responsive.css" rel="stylesheet" />
    <link href="css/prettyPhoto.css" rel="stylesheet" />    

    <link href="css/style.css" rel="stylesheet" />
    <link href="css/forum.css" rel="stylesheet" />
    
    <!-- For IE6-8 -->
    <!--[if lte IE 8]>
      <link href="css/ie.css" rel="stylesheet">
    <![endif]-->

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="shortcut icon" href="img/ico/favicon.ico" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/ico/apple-touch-icon-144-precomposed.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/ico/apple-touch-icon-114-precomposed.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/ico/apple-touch-icon-72-precomposed.png" />
    <link rel="apple-touch-icon-precomposed" href="img/ico/apple-touch-icon-57-precomposed.png" />

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>

  <body>


  <div class="container">

  <!-- Masthead
  ================================================== -->
  <header>
    
    <!-- Top Panel
    ================================================== -->
    <div id="top-panel">
      <div class="login-box">
        <form />
		  <div class="input-prepend">
            <span class="add-on"><i class="icon-user"></i></span><input class="span2" id="username" type="text" name="username" placeholder="User Name" />
          </div>
		  <div class="input-prepend">
            <span class="add-on"><i class="icon-lock"></i></span><input class="span2" id="userpassword" type="password" name="userpassword" placeholder="Password" />
          </div>
          <label class="checkbox">
    		<input type="checkbox" /> Remember me
  		  </label>
          <a  href="index.html" type="submit"  id ="toLogin" class="btn">Sign in</a>
          <span id="user-bar"></span>
        </form>
      </div><!-- login-box -->
      <div class="login-button toggle">
               <a href="login.html" id="toToLogin">Sign in</a>
               <span id="user-tec"></span>
      </div><!-- login-button -->
    </div><!-- top-panel -->


    
    <div class="row">
      <div class="span3"><div class="border-5-1"></div></div>
      <div class="span9"><div class="border-5-1 hide-border"></div></div>
    </div><!-- row -->

    

  </header>    



  <!-- Blog
  ================================================== -->
    <div class="row entry-blog">
	  <div class="span9">
	  
    	<!-- START POST #1 -->
	    <div class="row entry-post">
  	      <div class="span3">
	        <div class="entry-meta clearfix">
	          <span><strong><i class="icon-user icon-white"></i> Teacher:</strong> <a id="overview-teacher" href="#"></a></span>
	          <span><strong><i class="icon-comment icon-white"></i> Comments:</strong> <a id="overview-count" href="#"></a></span>
	          <span><strong><i class="icon-list-alt icon-white"></i> Course:</strong> <a href="#" id="overview-course"></a></span>	      
	
	        </div><!-- entry-meta -->
	      </div><!-- span3 -->
	  
	      <!-- POST FORMAT - IMAGE -->
	      <div class="span6">
	      <div class="row" id = 'forum-title'>
                                    
                     </div>
	      </div><!-- span6 -->
	    </div><!-- row -->
	    
	    <!-- DIVIDER -->
      	<div class="row margin40">
      	  <div class="span3"><div class="border-5-1"></div></div>
      	  <div class="span6"><div class="border-5-1 hide-border"></div></div>
    	</div><!-- row -->
  			
		<!-- END DISQUS COMMENTS  -->


	    <!-- COMMENTS  -->
       	<div class="row">
      	  <div class="span3" id="#comments-number">
      	      <h3 class="comment-title"></h3>
      	  </div><!-- span3 -->
      	  <div class="span6">
      	  	<h3 class="text-buffer">Comment Text:</h3>
      	  </div><!-- span6 -->
      	</div><!-- row -->
               <div id="comment-content"> 
</div> 
	    <!-- DIVIDER -->
      	<div class="row margin10-40">
      	  <div class="span3"><div class="border-5-1"></div></div>
      	  <div class="span6"><div class="border-5-1 hide-border"></div></div>
    	</div><!-- row -->
  	 	<!-- END COMMENTS -->
                                 <div id="comment">
       	<div class="row">
      	  <div class="span3">
      	      <h3>Leave a Replay:</h3>
      	  </div><!-- span3 -->
      	  <div class="span6">
      	  	<h3 class="text-buffer">Comment Text:</h3>
      	  </div><!-- span6 -->
      	</div><!-- row -->
      	<!-- Replay Form -->
        <div class="row margin0-40">
          
      	    <div class="span3">
	
      	  	</div><!-- span3 -->
      	  	<div class="span6">
			  <textarea id="textarea" value="s" rows="5" class="span6"></textarea>
              <button type="submit" id="submit-btn" class="btn">Submit Comment</button>
		    </div><!-- span6 -->      	  
        
    	</div><!-- row -->
    	</div>
	  </div><!-- span9 -->


  	  <!-- ============================================================================================= -->



	</div><!-- row -->



  
  </div><!-- /container -->



    <!-- Javascripts
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script src="js/jquery.easing.1.3.js"></script>
	<script src="js/superfish.js"></script>    
    <script src="js/bootstrap.min.js"></script>
	<script src="js/jquery.tweet.js"></script>
	<script src="js/jflickrfeed.min.js"></script>
	<script src="js/jquery.flexslider-min.js"></script>
	<script src="js/jquery.fitvid.js"></script>
	<script src="js/jquery.prettyPhoto.js"></script>
	<script src="js/jquery.preloader.js"></script>

    <!-- Support CSS3 Media Queries for IE 6-8 -->
	<script src="js/respond.min.js"></script>

	<script src="js/custom.js"></script>	

	<!-- For Facebook Social Plugins -->
	<div id="fb-root"></div>
	<script>(function(d, s, id) {
	  var js, fjs = d.getElementsByTagName(s)[0];
	  if (d.getElementById(id)) return;
	  js = d.createElement(s); js.id = id;
	  js.src = "//connect.facebook.net/en_GB/all.js#xfbml=1&appId=297648427000173";
	  fjs.parentNode.insertBefore(js, fjs);
	  }(document, 'script', 'facebook-jssdk'));
	</script>


	<!-- For Images Preloading -->
	<script type="text/javascript">var runFancy = true;</script>
	
    <!--[if IE]>
    <script type="text/javascript">
      runFancy = false;
    </script>
    <![endif]-->

</body>
<script>
if(localStorage.username !== undefined){ 
            $('#toToLogin').css('display','none')
        $('#user-tec').css('display','block')
        $('#user-tec').html(`您好,${localStorage.username}`)
        }
        else{
            $('#toToLogin').css('display','block')
        $('#user-tec').css('display','none')
        }
var commentsCount = 0;
               function getURLParam(){

 
var search=location.search;	//获取location的search属性，保存在search中
var params={};		//创建空对象params
if(search!=""){		//如果search不是空字符串
                   search.slice(1).split("&").forEach(	//?username=zhangdong&pwd=123456;//search去开头?，按&切割为数组，forEach
                                  function(val){
                                    var arr=val.split("=");		//将当前元素值按=切割，保存在arr中
                                      params[arr[0]]=arr[1];		//向params中添加一个元素,属性名为arr[0],值为arr[1]
                                  }
                   );
 }
  return params;		//返回params
}
function getNowFormatDate() {
     var date = new Date();
     var seperator1 = "-" ;
     var seperator2 = ":" ;
     var month = date.getMonth() + 1;
     var strDate = date.getDate();
     if (month >= 1 && month <= 9) {
         month = "0" + month;
     }
     if (strDate >= 0 && strDate <= 9) {
         strDate = "0" + strDate;
     }
     var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
             + " " + date.getHours() + seperator2 + date.getMinutes()
             + seperator2 + date.getSeconds();
     return currentdate;
}
function renderCommentcount(){
               $(".comment-title").text(`${commentsCount} Comments:`)
            $("#overview-count").text(commentsCount)
}
function renderComment(dataList){
               for(var i=0;i<dataList.length;i++){
                var renderHtml = `<div class="row comment">
      	  <div class="span3">
      	      <div class="well clearfix">
      	        <div class="user-thumb">
      	          <a href="#"><img src="img/blog/avatar0${Math.floor(Math.random()*3)+1}.jpg" alt="" /></a>
      	        </div><!-- user-thumb -->
      	        <div class="user-info">
			      <span class="author"><a href="#">${dataList[i].user_name}</a></span>
			      <span class="date"><small>${dataList[i].discusstion_time}</small></span>
      	        </div><!-- user-info -->
      	      </div><!-- well -->
      	  </div><!-- span3 -->
      	  <div class="span6">
      	    <div class="comment-text well">
      	      <p class="last">${dataList[i].discusstion_content}</p>
      	    </div><!-- comment-text -->
      	  </div><!-- span6 -->
      	</div><!-- row -->`;
            $("#comment-content").append(renderHtml)  
            }
            renderCommentcount()
            

}
$.ajax({
    url:'http://172.16.2.118:8111/getCourseAndTeacher',
						data:getURLParam(),
						type:'post',
						success:function (result,status,xhr){
							$('#overview-teacher').text(result[0].course_teacher)
                                                                                                         $('#overview-course').text(result[0].course_name)
                                                                                                         $('#forum-title').text(result[0].forum_name)
						}
					})
                                                            

                                                                           $.ajax({
                                                                               url:'http://172.16.2.118:8111/getDiscussion',
						data:getURLParam(),
						type:'post',
						success:function (result,status,xhr){
                                                                                                         commentsCount =  result.length
                                                                                                         renderComment(result)	
						}
		
                              })
                              
                              $("#submit-btn").click(function(){
                                             var user_id = localStorage.userid
                                             if(user_id===undefined){
                                                            alert("请登录后评论")
                                                            return;
                                             }
                                             var value =document.querySelector("#textarea").value
                                             console.log(value)
                                             if(value === ''){
                                                            alert("内容不能为空")
                                                            return 
                                             }
                                             $.ajax({
                                                 url:'http://172.16.2.118:8111/insertDisscussion',
						data:{
                                                                                              user_id:user_id,
                                                                                              forum_id:getURLParam().id,
                                                                                              content:value,
                                                                                              discusstion_time: getNowFormatDate()
                                                                                          },
						type:'post',
						success:function (result,status,xhr){
                                                                                                         commentsCount = commentsCount+1
                                                                                                         renderComment([{
                                                                                                                        user_name:localStorage.username,
                                                                                                                        discusstion_content:value,
                                                                                                                        discusstion_time: getNowFormatDate()

                                                                                                         }])
                                                                                                 
                                                                                                         document.querySelector("#textarea").value=''
                                                                                                         alert("发表成功")	
                                                                                                         

						}
		
                              })

               
})
</script>
</html>
